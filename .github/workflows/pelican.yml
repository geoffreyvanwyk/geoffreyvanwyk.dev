name: Deploy to GitHub Pages
on:
  workflow_call:
    inputs:
      settings:
        required: true
        description: "The path to your Pelican settings file (`pelican`'s `--settings` option), for example: 'publishconf.py'"
        type: string

      requirements:
        required: false
        default: "pelican"
        description: "The Python requirements to install, for example to enable markdown and typogrify use: 'pelican[markdown] typogrify' or if you have a requirements file use: '-r requirements.txt'"
        type: string

      output-path:
        required: false
        default: "output/"
        description: "Where to output the generated files (`pelican`'s `--output` option)"
        type: string

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install requirements
        run: pip install ${{ inputs.requirements }}

      - name: Build Pelican site
        run: |
          pelican \
            --settings "${{ inputs.settings }}" \
            --output "${{ inputs.output-path }}"

      - name: Setup Node.js
        uses: actions/setup-node@v2.1.2
        with:
          node-version: 20

      - name: Install Node.js dependencies
        run: npm install

      - name: Build Tailwind CSS
        run: npx tailwindcss --input themes/windy/assets/main.css --output output/theme/main.css

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          external_repository: geoffreyvanwyk/geoffreyvanwyk.github.io
          publish_branch: master
          publish_dir: ./output